<app-header></app-header>

<!-- Slideshow Component -->
<app-slideshow-component></app-slideshow-component>

<!-- Hero Section with Land Offer Cards -->
<section class="hero-section">
  <div class="container">
    <div class="row g-4">
      <!-- Rent Land Card -->
      <div class="col-md-4">
        <div class="land-card rent-card" (click)="scrollToOffers()">
          <div class="card-overlay">
            <h3 class="card-title">Rent Land</h3>
            <button class="btn btn-success btn-lg">Learn More</button>
          </div>
        </div>
      </div>
      
      <!-- Offer Land Card -->
      <div class="col-md-4">
        <div class="land-card offer-land-card" (click)="navigateToOfferLand()">
          <img src="/aboutPicture.jpg" alt="Offer Land" class="bg-image">
          <div class="card-overlay">
            <h3 class="card-title">Offer Land</h3>
            <button class="btn btn-success btn-lg">Offer Land</button>
          </div>
        </div>
      </div>

      <!-- Farmer Offer Card -->
      <div class="col-md-4">
        <div class="land-card farmer-offer-card" (click)="navigateToFarmerOffer()">
          <div class="card-overlay">
            <h3 class="card-title">Offer Farmer</h3>
            <button class="btn btn-success btn-lg">Offer Farmer</button>
          </div>
        </div>
      </div>

      <!-- Equipment Offer Card -->
      <div class="col-md-4">
        <div class="land-card equipment-offer-card" (click)="navigateToEquipmentOffer()">
          <div class="card-overlay">
            <h3 class="card-title">Offer Equipment</h3>
            <button class="btn btn-success btn-lg">Offer Equipment</button>
          </div>
        </div>
      </div>

    </div>
  </div>
</section>

<!-- Available Offers Section -->
<section class="offers-section" id="offers">
  <div class="container">
    <h2 class="section-title">Available Offers</h2>
    
    <!-- Search and Filter Bar -->
    <div class="search-filter-bar">
      <div class="row g-3">
        <div class="col-md-6">
          <div class="input-group">
            <input type="text" class="form-control" placeholder="Search for offers..." [(ngModel)]="searchTerm">
          </div>
        </div>
        <div class="col-md-6">
          <div class="row g-2">
                        <div class="col-4">
              <select class="form-select" [(ngModel)]="selectedCity">
                <option value="">All Cities</option>
                <option *ngFor="let city of cities" [value]="city">{{city}}</option>
              </select>
            </div>
            <div class="col-4">
              <select class="form-select" [(ngModel)]="selectedPeriod" (ngModelChange)="onPeriodFilterChange()">
                <option value="">All</option>
                <option value="rent">Rent Land</option>
                <option value="buy">Buy Land</option>
                <option value="hire">Hire a Farmer</option>
                <option value="equipment">Equipment</option>
              </select>
            </div>
            <div class="col-4" *ngIf="selectedPeriod === 'rent' || selectedPeriod === 'buy'">
              <input type="text" class="form-control" placeholder="e.g. 200 m²" [(ngModel)]="landSpaceFilter">
            </div>
            <div class="col-4" *ngIf="selectedPeriod === 'equipment'">
              <select class="form-select" [(ngModel)]="selectedCondition">
                <option value="">All Conditions</option>
                <option value="New">New</option>
                <option value="Used">Used</option>
              </select>
            </div>
            <div class="col-4" *ngIf="selectedPeriod === 'equipment'">
              <select class="form-select" [(ngModel)]="selectedDeliveryType">
                <option value="">All Delivery Types</option>
                <option value="SelfPickup">Self Pickup Only</option>
                <option value="DeliveryPaid">Delivery Available (Paid)</option>
                <option value="FreeDelivery">Free Delivery</option>
                <option value="DeliveryOnly">Delivery Only</option>
              </select>
            </div>
            <div class="col-4" *ngIf="selectedPeriod === 'hire'">
              <select class="form-select" [(ngModel)]="selectedAgeRange">
                <option *ngFor="let ageRange of ageRanges" [value]="ageRange.value">{{ageRange.label}}</option>
              </select>
            </div>
            <div class="col-4" *ngIf="selectedPeriod === 'hire'">
              <select class="form-select" [(ngModel)]="selectedEmploymentType">
                <option *ngFor="let employmentType of employmentTypes" [value]="employmentType.value">{{employmentType.label}}</option>
              </select>
            </div>
          </div>
        </div>
      </div>
      
      <div class="filter-buttons mt-3">
        <button class="btn btn-outline-success me-2" (click)="applyFilters()">Filter</button>
        <button class="btn btn-outline-secondary" (click)="clearFilters()">Clear</button>
      </div>
    </div>
    
    <!-- Loading State -->
    <div *ngIf="loading" class="text-center py-5">
      <div class="spinner-border text-success" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
    </div>
    
    <!-- Offers List -->
    <div *ngIf="!loading" class="offers-list">
      <!-- No offers message when database is empty -->
      <div *ngIf="allOffers.length === 0" class="text-center py-5">
        <h4 class="text-muted">No offers available</h4>
        <p class="text-muted">Check back later for new offers</p>
      </div>
      
      <!-- Unified offers list -->
      <div *ngFor="let offer of filteredOffers" 
           class="offer-card" 
           [class.farmer-offer-card]="offer.type === 'farmer'"
           [class.equipment-offer-card]="offer.type === 'equipment'"
           (click)="navigateToOffer(offer)">
        <div class="row g-0">
          <div class="col-md-4">
            <div class="offer-image">
              <img [src]="getUnifiedOfferImage(offer)" 
                   [alt]="offer.type === 'land' ? offer.title : (offer.type === 'farmer' ? offer.fullName : offer.title)" 
                   class="img-fluid"
                   (error)="onImageError($event)">
            </div>
          </div>
          <div class="col-md-8">
            <div class="offer-details">
              <h5 class="offer-title">
                {{ offer.type === 'land' ? offer.title : (offer.type === 'farmer' ? offer.fullName : offer.title) }}
              </h5>
              <p class="offer-info">
                <span *ngIf="offer.type === 'land'">
                  Land area: {{offer.landSize}} m², location: {{offer.location}}
                  <span *ngIf="offer.leaseDuration" class="lease-info">
                    , Lease: {{offer.leaseDuration}} months
                  </span>
                  <span *ngIf="offer.contactNumber" class="lease-info">
                    , Contact: {{offer.contactNumber}}
                  </span>
                </span>
                <span *ngIf="offer.type === 'farmer'">
                  <span *ngIf="offer.age">Age: {{offer.age}} years, </span>
                  Location: {{offer.currentAddress}}
                  <span *ngIf="offer.employmentType !== undefined" class="lease-info">
                    , Employment: {{getEmploymentTypeName(offer.employmentType)}}
                  </span>
                  <span *ngIf="offer.description" class="lease-info">
                    , {{offer.description}}
                  </span>
                </span>
                <span *ngIf="offer.type === 'equipment'">
                  Condition: {{offer.condition}}, Location: {{offer.location}}
                  <span *ngIf="offer.deliveryType" class="lease-info">
                    , Delivery: {{getDeliveryTypeName(offer.deliveryType)}}
                  </span>
                  <span *ngIf="offer.contactNumber" class="lease-info">
                    , Contact: {{offer.contactNumber}}
                  </span>
                </span>
              </p>
              <div class="offer-actions">
                <button class="btn btn-outline-primary btn-sm rounded-circle me-2" title="Chat" (click)="$event.stopPropagation()">
                  <i class="bi bi-chat"></i>
                </button>
                <button class="btn btn-outline-primary btn-sm rounded-circle" title="Favorite" (click)="$event.stopPropagation()">
                  <i class="bi bi-heart"></i>
                </button>
              </div>
            </div>
          </div>
        </div>
        <div class="offer-price" 
             [class.farmer-price]="offer.type === 'farmer'"
             [class.equipment-price]="offer.type === 'equipment'">
          {{ offer.type === 'land' ? (offer.price + ' JOD') : (offer.type === 'equipment' ? (offer.price + ' JOD') : 'Available') }}
        </div>
      </div>
    </div>
  </div>
</section>

<app-footer></app-footer>