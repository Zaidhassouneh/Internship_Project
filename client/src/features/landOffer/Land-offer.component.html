<app-header></app-header>

<div class="container mt-5">
  <div class="card shadow">
    <div class="card-body">
      <h4 class="card-title text-center mb-4">Create New Land Offer</h4>

      <form [formGroup]="offerForm" (ngSubmit)="submit()">
        
        <!-- Title -->
        <div class="mb-3">
          <label class="form-label">Offer Title</label>
          <input type="text" formControlName="title" class="form-control" placeholder="Enter title" />
          <div class="text-danger" *ngIf="f['title'].touched && f['title'].invalid">
            <small *ngIf="f['title'].errors?.['required']">Title is required.</small>
            <small *ngIf="f['title'].errors?.['minlength']">Title must be at least 3 characters.</small>
          </div>
        </div>

        <!-- Land Area -->
        <div class="mb-3">
          <label class="form-label">Land Area (m²)</label>
          <input type="number" formControlName="landSize" class="form-control" placeholder="Enter area" />
          <div class="text-danger" *ngIf="f['landSize'].touched && f['landSize'].invalid">
            <small *ngIf="f['landSize'].errors?.['required']">Land area is required.</small>
            <small *ngIf="f['landSize'].errors?.['min']">Must be at least 10 m².</small>
          </div>
        </div>

        <!-- For Rent / For Sale -->
        <div class="mb-3 form-check">
          <input type="checkbox" class="form-check-input" formControlName="isForRent" id="isForRent">
          <label for="isForRent" class="form-check-label">Is For Rent?</label>
        </div>

        <!-- Lease Duration -->
        <div class="mb-3" *ngIf="f['isForRent'].value">
          <label class="form-label">Lease Duration (months)</label>
          <input type="number" formControlName="leaseDuration" class="form-control" placeholder="e.g. 12" />
          <div class="text-danger" *ngIf="f['leaseDuration'].touched && f['leaseDuration'].invalid">
            <small *ngIf="f['leaseDuration'].errors?.['min']">Must be at least 0 months.</small>
          </div>
        </div>

        <!-- Price -->
        <div class="mb-3">
          <label class="form-label">Price (JOD)</label>
          <input type="number" formControlName="price" class="form-control" placeholder="Enter price" />
          <div class="text-danger" *ngIf="f['price'].touched && f['price'].invalid">
            <small *ngIf="f['price'].errors?.['required']">Price is required.</small>
            <small *ngIf="f['price'].errors?.['min']">Price must be greater than 0.</small>
          </div>
        </div>

        <!-- Location -->
        <div class="mb-3">
          <label class="form-label">Location</label>
          <input type="text" formControlName="location" class="form-control" placeholder="Enter location" />
          <div class="text-danger" *ngIf="f['location'].touched && f['location'].invalid">
            <small *ngIf="f['location'].errors?.['required']">Location is required.</small>
          </div>
        </div>

        <!-- Contact Number -->
        <div class="mb-3">
          <label class="form-label">Contact Number <span class="text-danger">*</span></label>
          <input type="tel" formControlName="contactNumber" class="form-control" placeholder="Enter your contact number" />
          <div class="text-danger" *ngIf="f['contactNumber'].touched && f['contactNumber'].invalid">
            <small *ngIf="f['contactNumber'].errors?.['required']">Contact number is required.</small>
            <small *ngIf="f['contactNumber'].errors?.['pattern']">Please enter a valid phone number.</small>
            <small *ngIf="f['contactNumber'].errors?.['minlength']">Contact number must be at least 8 characters.</small>
          </div>
        </div>

        <!-- Description -->
        <div class="mb-3">
          <label class="form-label">Description</label>
          <textarea formControlName="description" class="form-control" rows="3" placeholder="Provide details"></textarea>
          <div class="text-danger" *ngIf="f['description'].touched && f['description'].invalid">
            <small *ngIf="f['description'].errors?.['maxlength']">Max 500 characters allowed.</small>
          </div>
        </div>

        <!-- Images -->
        <div class="mb-3">
          <label class="form-label">Images</label>
          <div class="image-upload-container">
            <div class="image-upload-box" (click)="triggerFileInput()">
              <div class="upload-icon">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-6">
                  <path fill-rule="evenodd" d="M1.5 6a2.25 2.25 0 0 1 2.25-2.25h16.5A2.25 2.25 0 0 1 22.5 6v12a2.25 2.25 0 0 1-2.25 2.25H3.75A2.25 2.25 0 0 1 1.5 18V6ZM3 16.06V18c0 .414.336.75.75.75h16.5A.75.75 0 0 0 21 18v-1.94l-2.69-2.689a1.5 1.5 0 0 0-2.12 0l-.88.879.97.97a.75.75 0 1 1-1.06 1.06l-5.16-5.159a1.5 1.5 0 0 0-2.12 0L3 16.061Zm10.125-7.81a1.125 1.125 0 1 1 2.25 0 1.125 1.125 0 0 1-2.25 0Z" clip-rule="evenodd" />
                </svg>
              </div>
              <div class="upload-text">
                <p class="upload-title">Click to select images</p>
                <p class="upload-subtitle">Recommended: 4 images (multiple selection allowed)</p>
              </div>
            </div>
            <input 
              #fileInput
              type="file" 
              multiple 
              accept="image/*" 
              (change)="onFileSelected($event)" 
              class="file-input-hidden" 
            />
          </div>
        </div>

        <!-- Preview -->
        <div class="mb-3" *ngIf="previewUrls.length > 0">
          <label class="form-label">Selected Images</label>
          <div class="image-preview-container">
            <div *ngFor="let url of previewUrls; let i = index" class="image-preview-item">
              <img [src]="url" class="preview-image" />
              <button type="button" class="remove-image-btn" (click)="removeImage(i)" title="Remove image">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-5">
                  <path fill-rule="evenodd" d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25zm-1.72 6.97a.75.75 0 10-1.06 1.06L10.94 12l-1.72 1.72a.75.75 0 101.06 1.06L12 13.06l1.72 1.72a.75.75 0 101.06-1.06L13.06 12l1.72-1.72a.75.75 0 10-1.06-1.06L12 10.94l-1.72-1.72z" clip-rule="evenodd" />
                </svg>
              </button>
            </div>
          </div>
        </div>

        <!-- Submit -->
        <button type="submit" class="btn btn-success w-100" [disabled]="submitting || offerForm.invalid">
          {{ submitting ? 'Publishing...' : 'Publish Offer' }}
        </button>
      </form>
    </div>
  </div>
</div>

<app-footer></app-footer>
